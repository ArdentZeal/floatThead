// https://github.com/mkoryak/floatThead v0.7.2 - 10/23/12
(function(c){c.floatThead={defaults:{cellTag:"th",mixedModeScrolling:!1,zIndex:1001,debounceResizeMs:1,scrollingTop:0,scrollingBottom:0,scrollContainer:function(){return c([])}}};var b=c(window),F=b.width(),G=b.height(),v=0;c.fn.floatThead=function(e){if(_.isString(e))return this.filter("table").each(function(){var b=c(this).data("floatThead-attached");if(b&&_.isFunction(b[e]))b[e]()}),this;var k=c.extend({},c.floatThead.defaults,e);this.filter(":not(.floatThead-table)").each(function(){function e(){var a= l.outerHeight(!0);t.outerHeight(a);w.outerHeight(a)}function x(){p=(_.isFunction(k.scrollingTop)?k.scrollingTop(a):k.scrollingTop)||0;H=(_.isFunction(k.scrollingBottom)?k.scrollingBottom(a):k.scrollingBottom)||0}function y(){var b=l.find("tr:first>"+k.cellTag),h=_.reduce(b,function(a,b){return a+parseInt(c(b).attr("colspan")||1,10)},0);if(h!=I){I=h;for(var f=[],g=[],d=0;d<h;d++)f.push("<td/>"),g.push("<col/>");t.html(f.join(""));z.html(g.join(""));w=t.find(">td");J=c.browser.msie&&7==parseFloat(c.browser.version)? b:z.find("col")}b=function(){var b,f=a.find("tbody tr:first>td");if(f.length==h&&0<h){a.prepend(l);a.css(u);j.css(u);for(b=0;b<h;b++){var g=f.eq(b),d=g.outerWidth(!0);0==b&&(c.browser.mozilla&&(g.css("border-left-width")||g.css("border-right-width")))&&d--;J.eq(b).outerWidth(d);w.eq(b).outerWidth(d)}a.width(a.width());e();j.append(l);a.css(K);j.css(K)}else e(),j.append(l),a.css(u),j.css(u)};b();return b}function A(){var d=0<f.length,h=f.scrollTop(),j,g=0,e=i.height(),m=a.offset(),l=null;d?(e=f.offset(), g=m.top-e.top+h):j=m.top-(p+e+H+q.horizontal);c.browser.msie&&d&&(f.scrollTop(0),l=a.offset().top,f.scrollTop(h));return function(){var e,i;e=b.scrollTop();h=f.scrollTop();k.mixedModeScrolling&&(d=0<q.vertical);d?(m=a.offset(),e=g>h?c.browser.msie?l-e-h:m.top-e:m.top+h-e-g,i=m.left+f.scrollLeft()-b.scrollLeft()):(i=a.outerHeight(),e=e>j+i?i+p-(e-j):m.top>e+p-h?m.top+h-e:p,i=m.left-b.scrollLeft());return{top:e,left:i}}}function L(){var b=null,c=null,d=null;return function(g,k,m){var l=f.scrollLeft(); if(b!=g.top||c!=g.left)i.css({top:g.top,left:g.left}),b=g.top,c=g.left;k&&(g=f.width()||a.outerWidth(),i.width(g-q.vertical),j.outerWidth(a.outerWidth()));m&&e();d!=l&&(i.scrollLeft(l),d=l)}}function B(){f.length&&(q.horizontal=f.width()<a.width()?C:0,q.vertical=f.height()<a.height()?C:0)}var a=c(this);if(a.data("floatThead-attached"))return!0;if(!a.is("table"))throw Error('jQuery.floatThead must be run on a table element. ex: $("table").floatThead();');var p,H,q={vertical:0,horizontal:0},C,d=0;if(c.browser.msie&& 7==parseFloat(c.browser.version))d=15;else{var M=c("<div/>").css({width:100,height:100,overflow:"auto",position:"absolute",top:-1E3,left:-1E3}).prependTo("body").append("<div/>").find("div").css({width:"100%",height:200}),d=100-M.width();M.parent().remove()}C=d;var I=0,f=k.scrollContainer(a),l=a.find("thead:first"),j=c("<table/>"),z=c("<colgroup/>"),i=c('<div style="overflow: hidden;"></div>'),D=c("<thead/>"),t=c('<tr class="size-row"></tr>'),w=c([]),J=c([]);D.append(t);a.prepend(D);j.append(z);i.append(j); j.attr("class",a.attr("class"));j.addClass("floatThead-table").css("margin",0);a.after(i);i.css({position:"fixed",marginTop:0,zIndex:k.zIndex});x();var K={"table-layout":"fixed"},u={"table-layout":a.css("tableLayout")||"auto"};B();var n=A(),r=L();y();r(n(),!0);var E=function(){r(n(),!1)},N=function(){x();B();y();n=A();r=L();r(n(),!0,!0)},s=_.debounce(function(){B();x();n=A();r(n(),!0);y()},1);b.bind("scroll.floatTHead",E);f.bind("scroll.floatTHead",E);var O=N,d=_.debounce(function(){if(c.browser.msie&& 8>=parseFloat(c.browser.version)){var a=b.width(),d=b.height();if(F!=a||G!=d)F=b.width(),G=b.height(),O()}else O()},k.debounceResizeMs);b.bind("resize.floatTHead",d);a.bind("reflow",s);a:{if(a.dataTableSettings)for(d=0;d<a.dataTableSettings.length;d++)if(a[0]==a.dataTableSettings[d].nTable){d=!0;break a}d=!1}d&&a.bind("filter",s).bind("sort",s).bind("page",s);a.data("floatThead-attached",{destroy:function(){a.css("table-layout","auto");D.replaceWith(l);a.unbind("reflow");s=N=E=function(){};f.unbind("scroll.floatTHead"); i.remove();a.data("floatThead-attached",!1);v--;0==v&&(b.unbind("scroll.floatTHead"),b.unbind("resize.floatTHead"))},reflow:function(){a.trigger("reflow")},setHeaderHeight:function(){e()}});v++});return this}})(jQuery);