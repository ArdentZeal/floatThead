// @preserve jQuery.floatThead 1.2.11dev - http://mkoryak.github.io/floatThead/ - Copyright (c) 2012 - 2014 Misha Koryak
// @license MIT
!function(a){function b(a,b,c){if(8==i){var d=n.width(),e=g.debounce(function(){var a=n.width();d!=a&&(d=a,c())},a);n.on(b,e)}else n.on(b,g.debounce(c,a))}function c(a){window.console&&window.console&&window.console.log&&window.console.log("jQuery.floatThead: "+a)}function d(){var b=a('<div style="width:50px;height:50px;overflow-y:scroll;position:absolute;top:-200px;left:-200px;"><div style="height:100px;width:100%"></div>');a("body").append(b);var c=b.innerWidth(),d=a("div",b).innerWidth();return b.remove(),c-d}function e(a){if(a.dataTableSettings)for(var b=0;b<a.dataTableSettings.length;b++){var c=a.dataTableSettings[b].nTable;if(a[0]==c)return!0}return!1}function f(a,b,c){var d=c?"outerWidth":"width";if(l&&a.css("max-width")){var e=0;c&&(e+=parseInt(a.css("borderLeft"),10),e+=parseInt(a.css("borderRight"),10));for(var f=0;f<b.length;f++)e+=b.get(f).offsetWidth;return e}return a[d]()}a.floatThead=a.floatThead||{},a.floatThead.defaults={cellTag:null,headerCellSelector:"tr:first>th:visible",zIndex:1001,debounceResizeMs:10,useAbsolutePositioning:!0,scrollingTop:0,scrollingBottom:0,scrollContainer:function(){return a([])},getSizingRow:function(a){return a.find("tbody tr:visible:first>*:visible")},floatTableClass:"floatThead-table",floatWrapperClass:"floatThead-wrapper",floatContainerClass:"floatThead-container",copyTableClass:!0,enableAria:!1,autoReflow:!1,debug:!1};var g=window._,h="undefined"!=typeof MutationObserver,i=function(){for(var a=3,b=document.createElement("b"),c=b.all||[];a=1+a,b.innerHTML="<!--[if gt IE "+a+"]><i><![endif]-->",c[0];);return a>4?a:document.documentMode}(),j=/Gecko\//.test(navigator.userAgent),k=/WebKit\//.test(navigator.userAgent),l=function(){if(k){var b=a('<div style="width:0px"><table style="max-width:100%"><tr><th><div style="min-width:100px;">X</div></th></tr></table></div>');a("body").append(b);var c=0==b.find("table").width();return b.remove(),c}return!1},m=!j&&!i,n=a(window);a.fn.floatThead=function(j){if(j=j||{},!g&&(g=window._||a.floatThead._,!g))throw new Error("jquery.floatThead-slim.js requires underscore. You should use the non-lite version since you do not have underscore.");if(8>i)return this;m&&(document.createElement("fthtr"),document.createElement("fthtd"),document.createElement("fthfoot"));var o=null;if(g.isFunction(l)&&(l=l()),g.isString(j)){var p=j,q=this;return this.filter("table").each(function(){var b=a(this).data("floatThead-attached");if(b&&g.isFunction(b[p])){var c=b[p]();"undefined"!=typeof c&&(q=c)}}),q}var r=a.extend({},a.floatThead.defaults||{},j);if(a.each(j,function(b){b in a.floatThead.defaults||!r.debug||c("Used ["+b+"] key to init plugin, but that param is not an option for the plugin. Valid options are: "+g.keys(a.floatThead.defaults).join(", "))}),r.debug){var s=a.fn.jquery.split(".");1==parseInt(s[0],10)&&parseInt(s[1],10)<=7&&c("jQuery version "+a.fn.jquery+" detected! This plugin supports 1.8 or better, or 1.7.x with jQuery UI 1.8.24 -> http://jqueryui.com/resources/download/jquery-ui-1.8.24.zip")}return this.filter(":not(."+r.floatTableClass+")").each(function(){function c(){var b=0;C.find("tr:visible").each(function(){b+=a(this).outerHeight(!0)}),ab.outerHeight(b),bb.outerHeight(b)}function j(){var a=f(B,eb,!0),b=K.width()||a,c="hidden"!=K.css("overflow-y")?b-H.vertical:b;if(Z.width(c),Q){var d=100*a/c;U.css("width",d+"%")}else U.outerWidth(a)}function l(){E=(g.isFunction(r.scrollingTop)?r.scrollingTop(B):r.scrollingTop)||0,F=(g.isFunction(r.scrollingBottom)?r.scrollingBottom(B):r.scrollingBottom)||0}function p(){var b,c;if(X)b=W.find("col").length;else{var d;if(d=null==r.cellTag&&r.headerCellSelector?r.headerCellSelector:"tr:first>"+r.cellTag,g.isNumber(d))return d;c=C.find(d),b=0,c.each(function(){b+=parseInt(a(this).attr("colspan")||1,10)})}if(b!=J){J=b;for(var e,f=[],h=[],i=[],j=0;b>j;j++)f.push(r.enableAria&&(e=c.eq(j).text())?'<th scope="col" class="floatThead-col">'+e+"</th>":'<th class="floatThead-col"/>'),h.push("<col/>"),i.push("<fthtd style='display:table-cell;height:0;width:auto;'/>");h=h.join(""),f=f.join(""),m&&(i=i.join(""),Y.html(i),eb=Y.find("fthtd")),ab.html(f),bb=ab.find("th"),X||W.html(h),cb=W.find("col"),V.html(h),db=V.find("col")}return b}function q(){if(!G){if(G=!0,L){var a=f(B,eb),b=S.width();a>b&&B.css("minWidth",a)}B.css(hb),U.css(hb),U.append(C),D.before(_),c()}}function s(){G&&(G=!1,L&&B.width(jb),_.detach(),B.prepend(C),B.css(ib),U.css(ib),B.css("minWidth",kb),B.css("minWidth",f(B,eb)))}function t(a){L!=a&&(L=a,Z.css({position:L?"absolute":"fixed"}))}function u(a,b,c,d){return m?c:d?r.getSizingRow(a,b,c):b}function v(){var a,b=p();return function(){cb=W.find("col");var d=u(B,cb,eb,i);if(d.length==b&&b>0){if(!X)for(a=0;b>a;a++)cb.eq(a).css("width","");s();var e=[];for(a=0;b>a;a++)e[a]=d.get(a).offsetWidth;for(a=0;b>a;a++)db.eq(a).width(e[a]),cb.eq(a).width(e[a]);B.trigger(lb("sizes"),[e]),q()}else U.append(C),B.css(ib),U.css(ib),c()}}function w(a){var b=K.css("border-"+a+"-width"),c=0;return b&&~b.indexOf("px")&&(c=parseInt(b,10)),c}function x(){var a,b=K.scrollTop(),c=0,d=N?M.outerHeight(!0):0,e=O?d:-d,f=Z.height(),g=B.offset(),h=0;if(Q){var i=K.offset();c=g.top-i.top+b,N&&O&&(c+=d),c-=w("top"),h=w("left")}else a=g.top-E-f+F+H.horizontal;var j=n.scrollTop(),l=n.scrollLeft(),m=K.scrollLeft();return b=K.scrollTop(),function(i){var o=B[0].offsetWidth<=0&&B[0].offsetHeight<=0;if(!o&&$)return $=!1,setTimeout(function(){B.trigger("reflow")},1),null;if(o&&($=!0,!L))return null;if("windowScroll"==i?(j=n.scrollTop(),l=n.scrollLeft()):"containerScroll"==i?(b=K.scrollTop(),m=K.scrollLeft()):"init"!=i&&(j=n.scrollTop(),l=n.scrollLeft(),b=K.scrollTop(),m=K.scrollLeft()),!k||!(0>j||0>l)){if(T)t("windowScrollDone"==i?!0:!1);else if("windowScrollDone"==i)return null;g=B.offset(),N&&O&&(g.top+=d);var p,r,u=B.outerHeight();if(Q&&L){if(c>=b){var v=c-b;p=v>0?v:0}else p=R?0:b;r=h}else!Q&&L?(j>a+u+e?p=u-f+e:g.top>j+E?(p=0,s()):(p=E+j-g.top+c+(O?d:0),q()),r=0):Q&&!L?(c>b||b-c>u?(p=g.top-j,s()):(p=g.top+b-j-c,q()),r=g.left+m-l):Q||L||(j>a+u+e?p=u+E-j+a+e:g.top>j+E?(p=g.top-j,q()):p=E,r=g.left-l);var w={top:p,left:r};return B.trigger(lb("position"),w),w}}}function y(){var a=null,b=null,d=null;return function(e,f,g){null==e||a==e.top&&b==e.left||(Z.css({top:e.top,left:e.left}),a=e.top,b=e.left),f&&j(),g&&c();var h=K.scrollLeft();L&&d==h||(Z.scrollLeft(h),d=h)}}function z(){if(K.length)if(K.data().perfectScrollbar)H={horizontal:0,vertical:0};else{var a=K.width(),b=K.height(),c=B.height(),d=f(B,eb),e=d>a?I:0,g=c>b?I:0;H.horizontal=d>a-g?I:0,H.vertical=c>b-e?I:0}}var A=g.uniqueId(),B=a(this);if(B.data("floatThead-attached"))return!0;if(B.data("floatThead-options",r),!B.is("table"))throw new Error('jQuery.floatThead must be run on a table element. ex: $("table").floatThead();');h=r.autoReflow&&h;var C=B.find("thead:first"),D=B.find("tbody:first");if(0==C.length)throw new Error("jQuery.floatThead must be run on a table that contains a <thead> element");var E,F,G=!1,H={vertical:0,horizontal:0},I=d(),J=0,K=r.scrollContainer(B)||a([]),L=r.useAbsolutePositioning;null==L&&(L=r.scrollContainer(B).length),L||(G=!0);var M=B.find("caption"),N=1==M.length;if(N)var O="top"===(M.css("caption-side")||M.attr("align")||"top");var P=a('<fthfoot style="display:table-footer-group;border-spacing:0;height:0;border-collapse:collapse;"/>'),Q=K.length>0,R=!1,S=a([]),T=9>=i&&!Q&&L,U=a("<table/>"),V=a("<colgroup/>"),W=B.find("colgroup:first"),X=!0;0==W.length&&(W=a("<colgroup/>"),X=!1);var Y=a('<fthrow style="display:table-row;border-spacing:0;height:0;border-collapse:collapse"/>'),Z=a('<div style="overflow: hidden;" aria-hidden="true" class="floatThead-floatContainer"></div>'),$=!1,_=a("<thead/>"),ab=a('<tr class="size-row"/>'),bb=a([]),cb=a([]),db=a([]),eb=a([]);_.append(ab),B.prepend(W),m&&(P.append(Y),B.append(P)),U.append(V),Z.append(U),r.copyTableClass&&U.attr("class",B.attr("class")),U.attr({cellpadding:B.attr("cellpadding"),cellspacing:B.attr("cellspacing"),border:B.attr("border")});var fb=B.css("display");if(U.css({borderCollapse:B.css("borderCollapse"),border:B.css("border"),display:fb}),"none"==fb&&($=!0),U.addClass(r.floatTableClass).css("margin",0),L){var gb=function(a,b){var c=a.css("position"),d="relative"==c||"absolute"==c;if(!d||b){var e={paddingLeft:a.css("paddingLeft"),paddingRight:a.css("paddingRight")};Z.css(e),a=a.wrap("<div class='"+r.floatWrapperClass+"' style='position: relative; clear:both;'></div>").parent(),R=!0}return a};Q?(S=gb(K,!0),S.append(Z)):(S=gb(B),B.after(Z))}else B.after(Z);Z.css({position:L?"absolute":"fixed",marginTop:0,top:L?0:"auto",zIndex:r.zIndex}),Z.addClass(r.floatContainerClass),l();var hb={"table-layout":"fixed"},ib={"table-layout":B.css("tableLayout")||"auto"},jb=B[0].style.width||"",kb=B.css("minWidth")||"",lb=a.fn.floatThead.eventName=function(a){return a+".fth-"+A+".floatTHead"};z();var mb,nb=function(){(mb=v())()};nb();var ob=x(),pb=y();pb(ob("init"),!0);var qb=g.debounce(function(){pb(ob("windowScrollDone"),!1)},300),rb=function(){pb(ob("windowScroll"),!1),qb()},sb=function(){pb(ob("containerScroll"),!1)},tb=function(){l(),z(),nb(),ob=x(),(pb=y())(ob("resize"),!0,!0)},ub=g.debounce(function(){z(),l(),nb(),ob=x(),pb(ob("reflow"),!0)},1);if(Q?L?K.on(lb("scroll"),sb):(K.on(lb("scroll"),sb),n.on(lb("scroll"),rb)):n.on(lb("scroll"),rb),n.on(lb("load"),ub),b(r.debounceResizeMs,lb("resize"),tb),B.on("reflow",ub),e(B)&&B.on("filter",ub).on("sort",ub).on("page",ub),h){var vb=K.length?K[0]:B[0];o=new MutationObserver(function(a){for(var b=function(a){return a&&a[0]&&"THEAD"==a[0].nodeName},c=0;c<a.length;c++)if(!b(a[c].addedNodes)&&!b(a[c].removedNodes)){ub();break}}),o.observe(vb,{childList:!0,subtree:!0})}B.data("floatThead-attached",{destroy:function(){var a=".fth-"+A;s(),B.css(ib),W.remove(),m&&P.remove(),_.parent().length&&_.replaceWith(C),h&&(o.disconnect(),o=null),B.off("reflow"),K.off(a),R&&(K.length?K.unwrap():B.unwrap()),B.css("minWidth",kb),Z.remove(),B.data("floatThead-attached",!1),n.off(a)},reflow:function(){ub()},setHeaderHeight:function(){c()},getFloatContainer:function(){return Z},getRowGroups:function(){return G?Z.find("thead").add(B.find("tbody,tfoot")):B.find("thead,tbody,tfoot")}})}),this}}(jQuery);